>>>define TITLE         公式ゲートウェイにPHPを実行する脆弱性
>>>define DESCRIPTION   アップロードされたPHPを実行する脆弱性がありました。
>>>include "head.ja.h"
<!-- $Id$ -->

<p class="date">2009-02-15</p>

<p>新月掲示板の公式ゲートウェイ <a href="http://bbs.shingetsu.info/">bbs.shingetsu.info</a> に
アップロードしたファイルの拡張子が.phpのとき、
それをPHPのプログラムとしてサーバ上で実行してしまうという、
危険性の高い脆弱性がありました。
現在は修正されており、また、この脆弱性を利用した攻撃は確認されていません。
朔とApacheを組み合わせて使っている方は、同様の脆弱性が考えられますので、
直ちに設定を見直してください。
また、攻撃の痕跡がないかどうかを確認してください。
朔単体で使っている方には、この脆弱性はありません。
ご迷惑をおかけして申し訳ありません。</p>

<h2>原因</h2>
<p>bbs.shingetsu.info のサーバにはPHPがインストールされており、
拡張子が .php のファイルはPHPプログラムとして実行されていますが、
アップロードされたファイルを置いておくところも、除外する設定になっていませんでした。</p>

<h2>修正すべき点</h2>
<p><a href="/saku/#stable">最新版の朔</a>に更新してください。
file/apache.sample が修正されています。</p>

<p>更新できない場合は、Apacheの設定ファイル(配布物の file/apache.sample)の
/srv/saku/cache/ を設定しているところに
「RemoveHandler .php」という行を追加してください。</p>

<h2>経緯</h2>
<p>新月に拡張子が .php のファイルがアップロードされ、
それをクリックしたときの挙動がおかしかったので判明しました。
このプログラムは2種類あり、
1つは何かのサンプルプログラムであり、攻撃のためのプログラムではありません。
もう1つはfopen等のシステムにアクセスする関数を使っていて、攻撃に使用することが可能のように思えます。</p>

<h2>公式ゲートウェイへの攻撃はなかった</h2>
<p>サーバ上で任意のPHPプログラムを実行できるので、様々な攻撃がありえました。
しかし、公式ゲートウェイ上では、朔とApacheは別のユーザで動いているため、
攻撃のためのPHPプログラムは「攻撃をしたあと自分自身を消す」ことができません。
また、Apacheのログファイルを編集することができません。</p>

<p>検索した結果、上の2つ以外に拡張子が .php のファイルがアップロードされておらず、
攻撃に使えそうなプログラムへのアクセスはGooglebotの1回のアクセスのみでした。
したがって、攻撃はなかったと判断しました。</p>

>>>include "foot.ja.h"
